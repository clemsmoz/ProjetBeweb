{% extends "base.html" %}

{% block content %}
<title>Création évaluations</title>
<h1>Création évaluations</h1>
<button type="button" class="btn navbtn" onclick="window.location.href='/evaluations'">Retour</button>

<form action="{{ url_for('evaluations') }}" method="POST">
    <div class="form-group">
        <label for="titreEvaluation">Titre :</label>
        <input type="text" class="form-control" id="titreEvaluation" name="titreEvaluation">
    </div>
    <div class="form-group">
        <label for="dateEvaluation">Date d'évaluation :</label>
        <input type="date" class="form-control" id="dateEvaluation" name="dateEvaluation">
    </div>
    <div class="form-group">
        <label for="coeffItem">Coefficient des items :</label>
        <input type="number" class="form-control" id="coeffItem" name="coeffItem">
    </div>
    <div class="form-group">
        <label for="coeffEval">Coefficient de l'évaluation :</label>
        <input type="number" class="form-control" id="coeffEval" name="coeffEval">
    </div>
    <div class="form-group">
        <label for="noteEval">Note de l'évaluation :</label>
        <input type="number" class="form-control" id="noteEval" name="noteEval">
    </div>
    <div class="form-group">
        <label for="noteItem">Note des items :</label>
        <input type="number" class="form-control" id="noteItem" name="noteItem">
    </div>

    <h2>Liste des compétences</h2>
    <input type="text" id="search-input" class="form-control" placeholder="Rechercher..." oninput="searchTable()">

    <h3>Liste des activités</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Résumé</th>
            </tr>
        </thead>
        <tbody>
            {% for activite in activites %}
            <tr>
                <td>{{ activite.id }}</td>
                <td>{{ activite.titre }}</td>
                <td>{{ activite.contenu }}</td>
                <td>
                    <input type="checkbox" id="activite-{{ activite.id }}" value="{{ activite.titre }}"
                        onchange="handleCheckboxChange('{{ activite.id }}', 'activites')">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Liste des CP</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Contenu</th>
            </tr>
        </thead>
        <tbody>
            {% for cp in Cps %}
            <tr>
                <td>{{ cp.id }}</td>
                <td>{{ cp.titre }}</td>
                <td>{{ cp.contenu }}</td>
                <td>
                    <input type="checkbox" id="cp-{{ cp.id }}" value="{{ cp.titre }}"
                        onchange="handleCheckboxChange('{{ cp.id }}', 'cps')">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Liste des items</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Contenu</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.id }}</td>
                <td>{{ item.titre }}</td>
                <td>{{ item.contenu }}</td>
                <td>
                    <input type="checkbox" id="item-{{ item.id }}" value="{{ item.titre }}"
                        onchange="handleCheckboxChange('{{ item.id }}', 'items')">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Liste des modules</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Contenu</th>
            </tr>
        </thead>
        <tbody>
            {% for module in modules %}
            <tr>
                <td>{{ module.id }}</td>
                <td>{{ module.titre }}</td>
                <td>{{ module.contenu }}</td>
                <td>
                    <input type="checkbox" id="module-{{ module.id }}" value="{{ module.titre }}"
                        onchange="handleCheckboxChange('{{ module.id }}', 'modules')">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Champs de formulaire cachés pour les éléments sélectionnés -->
    <input type="hidden" name="activites" id="selected-activites-input">
    <input type="hidden" name="cps" id="selected-cps-input">
    <input type="hidden" name="items" id="selected-items-input">
    <input type="hidden" name="modules" id="selected-modules-input">

    <button type="submit" class="btn btn-primary">Envoyer</button>
</form>

<h2>Liste des éléments sélectionnés :</h2>
<h3>Activités :</h3>
<ul id="selected-activites" class="list-group"></ul>

<h3>CP :</h3>
<ul id="selected-cps" class="list-group"></ul>

<h3>Items :</h3>
<ul id="selected-items" class="list-group"></ul>

<h3>Modules :</h3>
<ul id="selected-modules" class="list-group"></ul>

<script>
    function searchTable() {
        const input = document.getElementById('search-input').value.toLowerCase();
        const tables = document.getElementsByTagName('table');
        Array.from(tables).forEach(table => {
            const rows = table.getElementsByTagName('tr');
            Array.from(rows).forEach(row => {
                const cells = row.getElementsByTagName('td');
                let found = false;
                for (let i = 0; i < cells.length; i++) {
                    const cell = cells[i];
                    if (cell.textContent.toLowerCase().includes(input)) {
                        found = true;
                        break;
                    }
                }
                row.style.display = found ? '' : 'none';
            });
        });
    }

    function handleCheckboxChange(id, type) {
        const checkbox = document.getElementById(`${type}-${id}`);
        const value = checkbox.value;
        const selectedList = document.getElementById(`selected-${type}`);
        const selectedInput = document.getElementById(`selected-${type}-input`);
        if (checkbox.checked) {
            const listItem = document.createElement('li');
            listItem.classList.add('list-group-item');
            listItem.textContent = value;
            selectedList.appendChild(listItem);
            selectedInput.value += `${value},`;
        } else {
            const listItems = selectedList.getElementsByTagName('li');
            for (let i = 0; i < listItems.length; i++) {
                const listItem = listItems[i];
                if (listItem.textContent === value) {
                    listItem.remove();
                    break;
                }
            }
            selectedInput.value = selectedInput.value.replace(`${value},`, '');
        }
    }
</script>

{% endblock %}
